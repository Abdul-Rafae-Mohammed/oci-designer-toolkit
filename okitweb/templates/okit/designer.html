{% extends "okit/base.html" %}

{% block navmenublock %}
    <ul class="nav-list">
        <li>
            <div>
                <span class="header-item">
                    <img id="header-item-icon" src="{{ url_for('static', filename='svg/compute.svg') }}" alt="Canvas Menu">
                    <span>Canvas</span>
                </span>
            </div>
        </li>
        <li><a id="file-new-menu-item" class="parent-item" href="{{ url_for('okit.designer') }}">New</a></li>
        <li><a id="file-load-menu-item" class="parent-item" href="#">Load</a></li>
        <li><a id="file-save-menu-item" class="parent-item" href="#">Save</a></li>
        <li><a id="file-redraw-menu-item" class="parent-item" href="#">Redraw</a></li>
        <!--li><a id="file-add-menu-item" class="parent-item" href="#">Add Compartment</a></li-->
        <li>
            <div>
                <span class="header-item">
                    <img id="header-item-icon" src="{{ url_for('static', filename='svg/compute.svg') }}" alt="Template Menu">
                    <span>Templates</span>
                </span>
            </div>
        </li>
        {% for okit_template in okit_templates %}
            <li><a id="{{ okit_template['id'] }}" title="{{ okit_template['description'] }}" class="parent-item" href="#"
                   onclick="loadTemplate('{{ url_for('static', filename='okit/templates/' + okit_template['json']) }}')">{{ okit_template['title'] }}</a></li>
        {% endfor %}
        <li>
            <div>
                <span class="header-item">
                    <img id="header-item-icon" src="{{ url_for('static', filename='svg/compute.svg') }}" alt="Query Menu">
                    <span>Query</span>
                </span>
            </div>
        </li>
        <!--li><a id="query-menu-item" class="parent-item" href="{{ url_for('okit.ociQuery', cloud='oci') }}" onclick="setBusyIcon()">OCI</a></li-->
        <li><a id="query-oci-menu-item" class="parent-item" href="#">OCI</a></li>
        <li>
            <div>
                <span class="header-item">
                    <img id="header-item-icon" src="{{ url_for('static', filename='svg/compute.svg') }}" alt="Generate Menu">
                    <span>Generate</span>
                </span>
            </div>
        </li>
        <li><a id="generate-terraform-menu-item" class="parent-item" href="#">Terraform</a></li>
        <li><a id="generate-ansible-menu-item" class="parent-item" href="#">Ansible</a></li>
        <!--li><a id="generate-resource-manager-menu-item" class="parent-item" href="#">Terraform 0.11</a></li-->
        <li>
            <div>
                <span class="header-item">
                    <img id="header-item-icon" src="{{ url_for('static', filename='svg/compute.svg') }}" alt="Export Menu">
                    <span>Export</span>
                </span>
            </div>
        </li>
        <li><a id="file-export-svg-menu-item" class="parent-item" href="#">SVG</a></li>
        <li><a id="file-export-rm-menu-item" class="parent-item" href="#">Resource Manager</a></li>
        <!--li><a id="file-export-orca-menu-item" class="parent-item" href="#">Orca</a></li-->
    </ul>
{% endblock %}

{% block headscripts %}
    <script type="text/javascript" src="{{ url_for('static', filename='okit/js/okit.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='okit/js/okit_designer.js') }}"></script>
    <script type="text/javascript">
        let palette_svg = {}
        let xmlSerialiser = new XMLSerializer();
        {% for palette_icon in palette_icons %}
            palette_svg["{{ palette_icon['title'] }}"] = "{{ url_for('static', filename='okit/palette/' + palette_icon['svg']) }}";
            $.ajax({
                type: 'get',
                url: "{{ url_for('static', filename='okit/palette/' + palette_icon['svg']) }}",
                dataType: 'xml',
                success: function(xml) {
                    console.info("{{ 'Loaded ' + palette_icon['svg'] }}");
                    let g = $(xml).find("g");
                    g[0].removeAttribute('transform');
                    palette_svg["{{ palette_icon['title'] }}"] = xmlSerialiser.serializeToString(g[0]);
                },
                error: function(xhr, status, error) {
                    console.groupCollapsed("{{ 'Error Loading ' + palette_icon['svg'] }}");
                    console.error('Error  : ' + error);
                    console.error('Status : ' + status);
                    console.groupEnd();
                }
            });
        {% endfor %}
    </script>
    {% if okit_query_request_json is defined %}
        <script type="text/javascript">
            console.info('Processing Query Javascript');
            okitQueryRequestJson = {{ okit_query_request_json | safe }};
            okitJson = {{ okit_query_response_json | safe }};
        </script>
    {% endif %}
    <script type="text/javascript" src="{{ url_for('static', filename='okit/js/okit_designer_svg.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='okit/js/okit_designer_drag_drop.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='okit/js/okit_designer_generation.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='okit/js/okit_designer_properties.js') }}"></script>
    {% for oci_asset_js in oci_assets_js %}
        <script type="text/javascript" src="{{ url_for('static', filename='okit/js/oci_assets/' + oci_asset_js) }}"></script>
    {% endfor %}
    <script type="text/javascript" src="{{ url_for('static', filename='okit/js/okit_designer_fragments.js') }}"></script>
{% endblock %}

{% block headcss %}
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/designer.css') }}">
{% endblock %}

{% block mainblock %}
    <div id="main-panel" class="main-panel flex-column">
        <div id="web-designer-panel" class="web-designer-panel flex-row">
            <div id="icon-palette" class="designer-left-column icons-palette">
                {% for palette_icon in palette_icons %}
                    <!--img class="palette-icon" src="{{ url_for('static', filename='okit/palette/' + palette_icon['svg']) }}" title="{{ palette_icon['title'] }}" draggable="true"-->
                {% endfor %}
                {% for palette_icon_group in palette_icon_groups %}
                    {% if palette_icon_group['name'] != 'Hidden' %}
                    <div id="{{ palette_icon_group['name'] }}" class="palette-icon-group">
                        <div class="palette-icon-group-header">
                            <img id="palette-group-icon" src="{{ url_for('static', filename='svg/' + palette_icon_group['name'] + '.svg') | lower }}" alt="Generate Menu"><label>{{ palette_icon_group['name'] }}</label>
                        </div>
                        <div class="palette-icon-group-icons">
                            {% for palette_icon in palette_icon_group['icons'] %}
                                <img class="palette-icon" src="{{ url_for('static', filename='okit/palette/' + palette_icon['svg']) }}" title="{{ palette_icon['title'] }}" draggable="true" alt="{{ palette_icon['title'] }}">
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                {% endfor %}
                <div id="fragments" class="palette-icon-group">
                    <div class="palette-icon-group-header">
                        <label>Fragments</label>
                    </div>
                    <div class="palette-icon-group-icons">
                        {% for fragment_icon in fragment_icons %}
                            <img class="fragment-icon" src="{{ url_for('static', filename='okit/fragments/svg/' + fragment_icon['svg']) }}" title="{{ fragment_icon['title'] }}" draggable="true" alt="{{ fragment_icon['title'] }}">
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div id="palette-dragbar" class="vertical-right-drag-bar"></div>
            <div id="canvas-wrapper" class="designer-centre-column canvas-wrapper">
            </div>
            <div id="properties-dragbar" class="vertical-left-drag-bar"></div>
            <div id="asset-properties" class="designer-right-column properties-wrapper">
                <div id="properties-and-source" class="properties-source-wrapper flex-column">
                    <div id="properties-toggle" class="properties-source-toggle">
                        <label><input type="radio" name="source-properties" value="source">Source</label>
                        <label><input type="radio" name="source-properties" value="properties" checked="checked">Properties</label>
                        <label><input type="radio" name="source-properties" value="settings">Settings</label>
                    </div>
                    <div id="sheets" class="sheets-column">
                        <div id="properties" class="property-sheet"></div>
                        <div id="json-display" class="source-code hidden">
                            <pre id="okitjson" readonly="readonly"></pre>
                        </div>
                        <div id="settings" class="setting-sheet hidden"></div>
                    </div>
                </div>
            </div>
        </div>
        <div id="menubar" class="menu-bar">
            <input type="file" id="files" class="file-button toolbar-button" name="file[]">
        </div>
    </div>
    <div id="context-menu" class="hidden context-menu"><button id="right-click-delete">Delete</button></div>
    <div id="query-progress" class="hidden query-progress">
        <table>
            <thead>
                <tr><th>Searching.....</th></tr>
            </thead>
            <tbody id="query-progress-tbody">
                <tr><td>Completed</td></tr>
            </tbody>
        </table>
    </div>
    <div id="query-oci" class="hidden query-oci">
        <form id="query-oci-form" action="{{ url_for('okit.designer') }}" method="post" onsubmit="setBusyIcon();">
            <table id="query-oci-table">
                <thead>
                    <tr><th colspan="2">Query Filters</th></tr>
                    <tr><td>Config Profile</td><td><input type="text" id="config_profile" name="config_profile" class="property-value" readonly="readonly"></td></tr>
                    <tr><td>Compartment</td><td>
                        <select id="query-compartment-id" name="compartment_id" form="query-oci-form">
                            {% for compartment in compartments %}
                                <option value="{{ compartment['id'] }}">{{ compartment['display_name'] }}</option>
                            {%  endfor %}
                        </select>
                    </td></tr>
                </thead>
                <tbody id="query-oci-tbody">
                </tbody>
                <tfoot>
                    <tr><td><input type = "submit" value = "Submit" /></td><td><input type="button" value="Cancel" onclick="handleCancelQuery()"/></td></tr>
                </tfoot>
            </table>
        </form>
    </div>
{% endblock %}

{% block footerblock %}
{% endblock %}

{% block footerscripts %}
{% endblock %}

